'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

/**
 * The reveal.js markdown plugin. Handles parsing of
 * markdown inside of presentations as well as loading
 * of external markdown documents.
 */
(function (root, factory) {
	if (typeof define === 'function' && define.amd) {
		root.marked = require('./marked');
		root.RevealMarkdown = factory(root.marked);
		root.RevealMarkdown.initialize();
	} else if ((typeof exports === 'undefined' ? 'undefined' : _typeof(exports)) === 'object') {
		module.exports = factory(require('./marked'));
	} else {
		// Browser globals (root is window)
		root.RevealMarkdown = factory(root.marked);
		root.RevealMarkdown.initialize();
	}
})(undefined, function (marked) {

	if (typeof marked === 'undefined') {
		throw 'The reveal.js Markdown plugin requires marked to be loaded';
	}

	if (typeof hljs !== 'undefined') {
		marked.setOptions({
			highlight: function highlight(lang, code) {
				return hljs.highlightAuto(lang, code).value;
			}
		});
	}

	var DEFAULT_SLIDE_SEPARATOR = '^\r?\n---\r?\n$',
	    DEFAULT_NOTES_SEPARATOR = 'note:',
	    DEFAULT_ELEMENT_ATTRIBUTES_SEPARATOR = '\\\.element\\\s*?(.+?)$',
	    DEFAULT_SLIDE_ATTRIBUTES_SEPARATOR = '\\\.slide:\\\s*?(\\\S.+?)$';

	var SCRIPT_END_PLACEHOLDER = '__SCRIPT_END__';

	/**
  * Retrieves the markdown contents of a slide section
  * element. Normalizes leading tabs/whitespace.
  */
	function getMarkdownFromSlide(section) {

		var template = section.querySelector('script');

		// strip leading whitespace so it isn't evaluated as code
		var text = (template || section).textContent;

		// restore script end tags
		text = text.replace(new RegExp(SCRIPT_END_PLACEHOLDER, 'g'), '</script>');

		var leadingWs = text.match(/^\n?(\s*)/)[1].length,
		    leadingTabs = text.match(/^\n?(\t*)/)[1].length;

		if (leadingTabs > 0) {
			text = text.replace(new RegExp('\\n?\\t{' + leadingTabs + '}', 'g'), '\n');
		} else if (leadingWs > 1) {
			text = text.replace(new RegExp('\\n? {' + leadingWs + '}', 'g'), '\n');
		}

		return text;
	}

	/**
  * Given a markdown slide section element, this will
  * return all arguments that aren't related to markdown
  * parsing. Used to forward any other user-defined arguments
  * to the output markdown slide.
  */
	function getForwardedAttributes(section) {

		var attributes = section.attributes;
		var result = [];

		for (var i = 0, len = attributes.length; i < len; i++) {
			var name = attributes[i].name,
			    value = attributes[i].value;

			// disregard attributes that are used for markdown loading/parsing
			if (/data\-(markdown|separator|vertical|notes)/gi.test(name)) continue;

			if (value) {
				result.push(name + '="' + value + '"');
			} else {
				result.push(name);
			}
		}

		return result.join(' ');
	}

	/**
  * Inspects the given options and fills out default
  * values for what's not defined.
  */
	function getSlidifyOptions(options) {

		options = options || {};
		options.separator = options.separator || DEFAULT_SLIDE_SEPARATOR;
		options.notesSeparator = options.notesSeparator || DEFAULT_NOTES_SEPARATOR;
		options.attributes = options.attributes || '';

		return options;
	}

	/**
  * Helper function for constructing a markdown slide.
  */
	function createMarkdownSlide(content, options) {

		options = getSlidifyOptions(options);

		var notesMatch = content.split(new RegExp(options.notesSeparator, 'mgi'));

		if (notesMatch.length === 2) {
			content = notesMatch[0] + '<aside class="notes">' + marked(notesMatch[1].trim()) + '</aside>';
		}

		// prevent script end tags in the content from interfering
		// with parsing
		content = content.replace(/<\/script>/g, SCRIPT_END_PLACEHOLDER);

		return '<script type="text/template">' + content + '</script>';
	}

	/**
  * Parses a data string into multiple slides based
  * on the passed in separator arguments.
  */
	function slidify(markdown, options) {

		options = getSlidifyOptions(options);

		var separatorRegex = new RegExp(options.separator + (options.verticalSeparator ? '|' + options.verticalSeparator : ''), 'mg'),
		    horizontalSeparatorRegex = new RegExp(options.separator);

		var matches,
		    lastIndex = 0,
		    isHorizontal,
		    wasHorizontal = true,
		    content,
		    sectionStack = [];

		// iterate until all blocks between separators are stacked up
		while (matches = separatorRegex.exec(markdown)) {
			notes = null;

			// determine direction (horizontal by default)
			isHorizontal = horizontalSeparatorRegex.test(matches[0]);

			if (!isHorizontal && wasHorizontal) {
				// create vertical stack
				sectionStack.push([]);
			}

			// pluck slide content from markdown input
			content = markdown.substring(lastIndex, matches.index);

			if (isHorizontal && wasHorizontal) {
				// add to horizontal stack
				sectionStack.push(content);
			} else {
				// add to vertical stack
				sectionStack[sectionStack.length - 1].push(content);
			}

			lastIndex = separatorRegex.lastIndex;
			wasHorizontal = isHorizontal;
		}

		// add the remaining slide
		(wasHorizontal ? sectionStack : sectionStack[sectionStack.length - 1]).push(markdown.substring(lastIndex));

		var markdownSections = '';

		// flatten the hierarchical stack, and insert <section data-markdown> tags
		for (var i = 0, len = sectionStack.length; i < len; i++) {
			// vertical
			if (sectionStack[i] instanceof Array) {
				markdownSections += '<section ' + options.attributes + '>';

				sectionStack[i].forEach(function (child) {
					markdownSections += '<section data-markdown>' + createMarkdownSlide(child, options) + '</section>';
				});

				markdownSections += '</section>';
			} else {
				markdownSections += '<section ' + options.attributes + ' data-markdown>' + createMarkdownSlide(sectionStack[i], options) + '</section>';
			}
		}

		return markdownSections;
	}

	/**
  * Parses any current data-markdown slides, splits
  * multi-slide markdown into separate sections and
  * handles loading of external markdown.
  */
	function processSlides() {

		var sections = document.querySelectorAll('[data-markdown]'),
		    section;

		for (var i = 0, len = sections.length; i < len; i++) {

			section = sections[i];

			if (section.getAttribute('data-markdown').length) {

				var xhr = new XMLHttpRequest(),
				    url = section.getAttribute('data-markdown');

				datacharset = section.getAttribute('data-charset');

				// see https://developer.mozilla.org/en-US/docs/Web/API/element.getAttribute#Notes
				if (datacharset != null && datacharset != '') {
					xhr.overrideMimeType('text/html; charset=' + datacharset);
				}

				xhr.onreadystatechange = function () {
					if (xhr.readyState === 4) {
						// file protocol yields status code 0 (useful for local debug, mobile applications etc.)
						if (xhr.status >= 200 && xhr.status < 300 || xhr.status === 0) {

							section.outerHTML = slidify(xhr.responseText, {
								separator: section.getAttribute('data-separator'),
								verticalSeparator: section.getAttribute('data-separator-vertical'),
								notesSeparator: section.getAttribute('data-separator-notes'),
								attributes: getForwardedAttributes(section)
							});
						} else {

							section.outerHTML = '<section data-state="alert">' + 'ERROR: The attempt to fetch ' + url + ' failed with HTTP status ' + xhr.status + '.' + 'Check your browser\'s JavaScript console for more details.' + '<p>Remember that you need to serve the presentation HTML from a HTTP server.</p>' + '</section>';
						}
					}
				};

				xhr.open('GET', url, false);

				try {
					xhr.send();
				} catch (e) {
					alert('Failed to get the Markdown file ' + url + '. Make sure that the presentation and the file are served by a HTTP server and the file can be found there. ' + e);
				}
			} else if (section.getAttribute('data-separator') || section.getAttribute('data-separator-vertical') || section.getAttribute('data-separator-notes')) {

				section.outerHTML = slidify(getMarkdownFromSlide(section), {
					separator: section.getAttribute('data-separator'),
					verticalSeparator: section.getAttribute('data-separator-vertical'),
					notesSeparator: section.getAttribute('data-separator-notes'),
					attributes: getForwardedAttributes(section)
				});
			} else {
				section.innerHTML = createMarkdownSlide(getMarkdownFromSlide(section));
			}
		}
	}

	/**
  * Check if a node value has the attributes pattern.
  * If yes, extract it and add that value as one or several attributes
  * the the terget element.
  *
  * You need Cache Killer on Chrome to see the effect on any FOM transformation
  * directly on refresh (F5)
  * http://stackoverflow.com/questions/5690269/disabling-chrome-cache-for-website-development/7000899#answer-11786277
  */
	function addAttributeInElement(node, elementTarget, separator) {

		var mardownClassesInElementsRegex = new RegExp(separator, 'mg');
		var mardownClassRegex = new RegExp("([^\"= ]+?)=\"([^\"=]+?)\"", 'mg');
		var nodeValue = node.nodeValue;
		if (matches = mardownClassesInElementsRegex.exec(nodeValue)) {

			var classes = matches[1];
			nodeValue = nodeValue.substring(0, matches.index) + nodeValue.substring(mardownClassesInElementsRegex.lastIndex);
			node.nodeValue = nodeValue;
			while (matchesClass = mardownClassRegex.exec(classes)) {
				elementTarget.setAttribute(matchesClass[1], matchesClass[2]);
			}
			return true;
		}
		return false;
	}

	/**
  * Add attributes to the parent element of a text node,
  * or the element of an attribute node.
  */
	function addAttributes(section, element, previousElement, separatorElementAttributes, separatorSectionAttributes) {

		if (element != null && element.childNodes != undefined && element.childNodes.length > 0) {
			previousParentElement = element;
			for (var i = 0; i < element.childNodes.length; i++) {
				childElement = element.childNodes[i];
				if (i > 0) {
					j = i - 1;
					while (j >= 0) {
						aPreviousChildElement = element.childNodes[j];
						if (typeof aPreviousChildElement.setAttribute == 'function' && aPreviousChildElement.tagName != "BR") {
							previousParentElement = aPreviousChildElement;
							break;
						}
						j = j - 1;
					}
				}
				parentSection = section;
				if (childElement.nodeName == "section") {
					parentSection = childElement;
					previousParentElement = childElement;
				}
				if (typeof childElement.setAttribute == 'function' || childElement.nodeType == Node.COMMENT_NODE) {
					addAttributes(parentSection, childElement, previousParentElement, separatorElementAttributes, separatorSectionAttributes);
				}
			}
		}

		if (element.nodeType == Node.COMMENT_NODE) {
			if (addAttributeInElement(element, previousElement, separatorElementAttributes) == false) {
				addAttributeInElement(element, section, separatorSectionAttributes);
			}
		}
	}

	/**
  * Converts any current data-markdown slides in the
  * DOM to HTML.
  */
	function convertSlides() {

		var sections = document.querySelectorAll('[data-markdown]');

		for (var i = 0, len = sections.length; i < len; i++) {

			var section = sections[i];

			// Only parse the same slide once
			if (!section.getAttribute('data-markdown-parsed')) {

				section.setAttribute('data-markdown-parsed', true);

				var notes = section.querySelector('aside.notes');
				var markdown = getMarkdownFromSlide(section);

				section.innerHTML = marked(markdown);
				addAttributes(section, section, null, section.getAttribute('data-element-attributes') || section.parentNode.getAttribute('data-element-attributes') || DEFAULT_ELEMENT_ATTRIBUTES_SEPARATOR, section.getAttribute('data-attributes') || section.parentNode.getAttribute('data-attributes') || DEFAULT_SLIDE_ATTRIBUTES_SEPARATOR);

				// If there were notes, we need to re-add them after
				// having overwritten the section's HTML
				if (notes) {
					section.appendChild(notes);
				}
			}
		}
	}

	// API
	return {

		initialize: function initialize() {
			processSlides();
			convertSlides();
		},

		// TODO: Do these belong in the API?
		processSlides: processSlides,
		convertSlides: convertSlides,
		slidify: slidify

	};
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsdWdpbi9tYXJrZG93bi9tYXJrZG93bi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFLQyxXQUFVLElBQVYsRUFBZ0IsT0FBaEIsRUFBMEI7QUFDMUIsS0FBSSxPQUFPLE1BQVAsS0FBa0IsVUFBbEIsSUFBZ0MsT0FBTyxHQUEzQyxFQUFnRDtBQUMvQyxPQUFLLE1BQUwsR0FBYyxRQUFTLFVBQVQsQ0FBZDtBQUNBLE9BQUssY0FBTCxHQUFzQixRQUFTLEtBQUssTUFBZCxDQUF0QjtBQUNBLE9BQUssY0FBTCxDQUFvQixVQUFwQjtBQUNBLEVBSkQsTUFJTyxJQUFJLFFBQU8sT0FBUCx5Q0FBTyxPQUFQLE9BQW1CLFFBQXZCLEVBQWtDO0FBQ3hDLFNBQU8sT0FBUCxHQUFpQixRQUFTLFFBQVMsVUFBVCxDQUFULENBQWpCO0FBQ0EsRUFGTSxNQUVBOztBQUVOLE9BQUssY0FBTCxHQUFzQixRQUFTLEtBQUssTUFBZCxDQUF0QjtBQUNBLE9BQUssY0FBTCxDQUFvQixVQUFwQjtBQUNBO0FBQ0QsQ0FaQSxhQVlRLFVBQVUsTUFBVixFQUFtQjs7QUFFM0IsS0FBSSxPQUFPLE1BQVAsS0FBa0IsV0FBdEIsRUFBb0M7QUFDbkMsUUFBTSw0REFBTjtBQUNBOztBQUVELEtBQUksT0FBTyxJQUFQLEtBQWdCLFdBQXBCLEVBQWtDO0FBQ2pDLFNBQU8sVUFBUCxDQUFrQjtBQUNqQixjQUFXLG1CQUFVLElBQVYsRUFBZ0IsSUFBaEIsRUFBdUI7QUFDakMsV0FBTyxLQUFLLGFBQUwsQ0FBb0IsSUFBcEIsRUFBMEIsSUFBMUIsRUFBaUMsS0FBeEM7QUFDQTtBQUhnQixHQUFsQjtBQUtBOztBQUVELEtBQUksMEJBQTBCLGlCQUE5QjtLQUNDLDBCQUEwQixPQUQzQjtLQUVDLHVDQUF1Qyx5QkFGeEM7S0FHQyxxQ0FBcUMsNEJBSHRDOztBQUtBLEtBQUkseUJBQXlCLGdCQUE3Qjs7Ozs7O0FBT0EsVUFBUyxvQkFBVCxDQUErQixPQUEvQixFQUF5Qzs7QUFF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QXRCLENBQUwsRUFBc0Q7O0FBRXJELFlBQVEsWUFBUixDQUFzQixzQkFBdEIsRUFBOEMsSUFBOUM7O0FBRUEsUUFBSSxRQUFRLFFBQVEsYUFBUixDQUF1QixhQUF2QixDQUFaO0FBQ0EsUUFBSSxXQUFXLHFCQUFzQixPQUF0QixDQUFmOztBQUVBLFlBQVEsU0FBUixHQUFvQixPQUFRLFFBQVIsQ0FBcEI7QUFDQSxrQkFBZ0IsT0FBaEIsRUFBeUIsT0FBekIsRUFBa0MsSUFBbEMsRUFBd0MsUUFBUSxZQUFSLENBQXNCLHlCQUF0QixLQUNwQyxRQUFRLFVBQVIsQ0FBbUIsWUFBbkIsQ0FBaUMseUJBQWpDLENBRG9DLElBRXBDLG9DQUZKLEVBR0ksUUFBUSxZQUFSLENBQXNCLGlCQUF0QixLQUNBLFFBQVEsVUFBUixDQUFtQixZQUFuQixDQUFpQyxpQkFBakMsQ0FEQSxJQUVBLGtDQUxKOzs7O0FBU0EsUUFBSSxLQUFKLEVBQVk7QUFDWCxhQUFRLFdBQVIsQ0FBcUIsS0FBckI7QUFDQTtBQUVEO0FBRUQ7QUFFRDs7O0FBR0QsUUFBTzs7QUFFTixjQUFZLHNCQUFXO0FBQ3RCO0FBQ0E7QUFDQSxHQUxLOzs7QUFRTixpQkFBZSxhQVJUO0FBU04saUJBQWUsYUFUVDtBQVVOLFdBQVM7O0FBVkgsRUFBUDtBQWNBLENBL1lBLENBQUQiLCJmaWxlIjoicGx1Z2luL21hcmtkb3duL21hcmtkb3duLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGhlIHJldmVhbC5qcyBtYXJrZG93biBwbHVnaW4uIEhhbmRsZXMgcGFyc2luZyBvZlxuICogbWFya2Rvd24gaW5zaWRlIG9mIHByZXNlbnRhdGlvbnMgYXMgd2VsbCBhcyBsb2FkaW5nXG4gKiBvZiBleHRlcm5hbCBtYXJrZG93biBkb2N1bWVudHMuXG4gKi9cbihmdW5jdGlvbiggcm9vdCwgZmFjdG9yeSApIHtcblx0aWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuXHRcdHJvb3QubWFya2VkID0gcmVxdWlyZSggJy4vbWFya2VkJyApO1xuXHRcdHJvb3QuUmV2ZWFsTWFya2Rvd24gPSBmYWN0b3J5KCByb290Lm1hcmtlZCApO1xuXHRcdHJvb3QuUmV2ZWFsTWFya2Rvd24uaW5pdGlhbGl6ZSgpO1xuXHR9IGVsc2UgaWYoIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyApIHtcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoIHJlcXVpcmUoICcuL21hcmtlZCcgKSApO1xuXHR9IGVsc2Uge1xuXHRcdC8vIEJyb3dzZXIgZ2xvYmFscyAocm9vdCBpcyB3aW5kb3cpXG5cdFx0cm9vdC5SZXZlYWxNYXJrZG93biA9IGZhY3RvcnkoIHJvb3QubWFya2VkICk7XG5cdFx0cm9vdC5SZXZlYWxNYXJrZG93bi5pbml0aWFsaXplKCk7XG5cdH1cbn0oIHRoaXMsIGZ1bmN0aW9uKCBtYXJrZWQgKSB7XG5cblx0aWYoIHR5cGVvZiBtYXJrZWQgPT09ICd1bmRlZmluZWQnICkge1xuXHRcdHRocm93ICdUaGUgcmV2ZWFsLmpzIE1hcmtkb3duIHBsdWdpbiByZXF1aXJlcyBtYXJrZWQgdG8gYmUgbG9hZGVkJztcblx0fVxuXG5cdGlmKCB0eXBlb2YgaGxqcyAhPT0gJ3VuZGVmaW5lZCcgKSB7XG5cdFx0bWFya2VkLnNldE9wdGlvbnMoe1xuXHRcdFx0aGlnaGxpZ2h0OiBmdW5jdGlvbiggbGFuZywgY29kZSApIHtcblx0XHRcdFx0cmV0dXJuIGhsanMuaGlnaGxpZ2h0QXV0byggbGFuZywgY29kZSApLnZhbHVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0dmFyIERFRkFVTFRfU0xJREVfU0VQQVJBVE9SID0gJ15cXHI/XFxuLS0tXFxyP1xcbiQnLFxuXHRcdERFRkFVTFRfTk9URVNfU0VQQVJBVE9SID0gJ25vdGU6Jyxcblx0XHRERUZBVUxUX0VMRU1FTlRfQVRUUklCVVRFU19TRVBBUkFUT1IgPSAnXFxcXFxcLmVsZW1lbnRcXFxcXFxzKj8oLis/KSQnLFxuXHRcdERFRkFVTFRfU0xJREVfQVRUUklCVVRFU19TRVBBUkFUT1IgPSAnXFxcXFxcLnNsaWRlOlxcXFxcXHMqPyhcXFxcXFxTLis/KSQnO1xuXG5cdHZhciBTQ1JJUFRfRU5EX1BMQUNFSE9MREVSID0gJ19fU0NSSVBUX0VORF9fJztcblxuXG5cdC8qKlxuXHQgKiBSZXRyaWV2ZXMgdGhlIG1hcmtkb3duIGNvbnRlbnRzIG9mIGEgc2xpZGUgc2VjdGlvblxuXHQgKiBlbGVtZW50LiBOb3JtYWxpemVzIGxlYWRpbmcgdGFicy93aGl0ZXNwYWNlLlxuXHQgKi9cblx0ZnVuY3Rpb24gZ2V0TWFya2Rvd25Gcm9tU2xpZGUoIHNlY3Rpb24gKSB7XG5cblx0XHR2YXIgdGVtcGxhdGUgPSBzZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoICdzY3JpcHQnICk7XG5cblx0XHQvLyBzdHJpcCBsZWFkaW5nIHdoaXRlc3BhY2Ugc28gaXQgaXNuJ3QgZXZhbHVhdGVkIGFzIGNvZGVcblx0XHR2YXIgdGV4dCA9ICggdGVtcGxhdGUgfHwgc2VjdGlvbiApLnRleHRDb250ZW50O1xuXG5cdFx0Ly8gcmVzdG9yZSBzY3JpcHQgZW5kIHRhZ3Ncblx0XHR0ZXh0ID0gdGV4dC5yZXBsYWNlKCBuZXcgUmVnRXhwKCBTQ1JJUFRfRU5EX1BMQUNFSE9MREVSLCAnZycgKSwgJzwvc2NyaXB0PicgKTtcblxuXHRcdHZhciBsZWFkaW5nV3MgPSB0ZXh0Lm1hdGNoKCAvXlxcbj8oXFxzKikvIClbMV0ubGVuZ3RoLFxuXHRcdFx0bGVhZGluZ1RhYnMgPSB0ZXh0Lm1hdGNoKCAvXlxcbj8oXFx0KikvIClbMV0ubGVuZ3RoO1xuXG5cdFx0aWYoIGxlYWRpbmdUYWJzID4gMCApIHtcblx0XHRcdHRleHQgPSB0ZXh0LnJlcGxhY2UoIG5ldyBSZWdFeHAoJ1xcXFxuP1xcXFx0eycgKyBsZWFkaW5nVGFicyArICd9JywnZycpLCAnXFxuJyApO1xuXHRcdH1cblx0XHRlbHNlIGlmKCBsZWFkaW5nV3MgPiAxICkge1xuXHRcdFx0dGV4dCA9IHRleHQucmVwbGFjZSggbmV3IFJlZ0V4cCgnXFxcXG4/IHsnICsgbGVhZGluZ1dzICsgJ30nLCAnZycpLCAnXFxuJyApO1xuXHRcdH1cblxuXHRcdHJldHVybiB0ZXh0O1xuXG5cdH1cblxuXHQvKipcblx0ICogR2l2ZW4gYSBtYXJrZG93biBzbGlkZSBzZWN0aW9uIGVsZW1lbnQsIHRoaXMgd2lsbFxuXHQgKiByZXR1cm4gYWxsIGFyZ3VtZW50cyB0aGF0IGFyZW4ndCByZWxhdGVkIHRvIG1hcmtkb3duXG5cdCAqIHBhcnNpbmcuIFVzZWQgdG8gZm9yd2FyZCBhbnkgb3RoZXIgdXNlci1kZWZpbmVkIGFyZ3VtZW50c1xuXHQgKiB0byB0aGUgb3V0cHV0IG1hcmtkb3duIHNsaWRlLlxuXHQgKi9cblx0ZnVuY3Rpb24gZ2V0Rm9yd2FyZGVkQXR0cmlidXRlcyggc2VjdGlvbiApIHtcblxuXHRcdHZhciBhdHRyaWJ1dGVzID0gc2VjdGlvbi5hdHRyaWJ1dGVzO1xuXHRcdHZhciByZXN1bHQgPSBbXTtcblxuXHRcdGZvciggdmFyIGkgPSAwLCBsZW4gPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrICkge1xuXHRcdFx0dmFyIG5hbWUgPSBhdHRyaWJ1dGVzW2ldLm5hbWUsXG5cdFx0XHRcdHZhbHVlID0gYXR0cmlidXRlc1tpXS52YWx1ZTtcblxuXHRcdFx0Ly8gZGlzcmVnYXJkIGF0dHJpYnV0ZXMgdGhhdCBhcmUgdXNlZCBmb3IgbWFya2Rvd24gbG9hZGluZy9wYXJzaW5nXG5cdFx0XHRpZiggL2RhdGFcXC0obWFya2Rvd258c2VwYXJhdG9yfHZlcnRpY2FsfG5vdGVzKS9naS50ZXN0KCBuYW1lICkgKSBjb250aW51ZTtcblxuXHRcdFx0aWYoIHZhbHVlICkge1xuXHRcdFx0XHRyZXN1bHQucHVzaCggbmFtZSArICc9XCInICsgdmFsdWUgKyAnXCInICk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0cmVzdWx0LnB1c2goIG5hbWUgKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gcmVzdWx0LmpvaW4oICcgJyApO1xuXG5cdH1cblxuXHQvKipcblx0ICogSW5zcGVjdHMgdGhlIGdpdmVuIG9wdGlvbnMgYW5kIGZpbGxzIG91dCBkZWZhdWx0XG5cdCAqIHZhbHVlcyBmb3Igd2hhdCdzIG5vdCBkZWZpbmVkLlxuXHQgKi9cblx0ZnVuY3Rpb24gZ2V0U2xpZGlmeU9wdGlvbnMoIG9wdGlvbnMgKSB7XG5cblx0XHRvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblx0XHRvcHRpb25zLnNlcGFyYXRvciA9IG9wdGlvbnMuc2VwYXJhdG9yIHx8IERFRkFVTFRfU0xJREVfU0VQQVJBVE9SO1xuXHRcdG9wdGlvbnMubm90ZXNTZXBhcmF0b3IgPSBvcHRpb25zLm5vdGVzU2VwYXJhdG9yIHx8IERFRkFVTFRfTk9URVNfU0VQQVJBVE9SO1xuXHRcdG9wdGlvbnMuYXR0cmlidXRlcyA9IG9wdGlvbnMuYXR0cmlidXRlcyB8fCAnJztcblxuXHRcdHJldHVybiBvcHRpb25zO1xuXG5cdH1cblxuXHQvKipcblx0ICogSGVscGVyIGZ1bmN0aW9uIGZvciBjb25zdHJ1Y3RpbmcgYSBtYXJrZG93biBzbGlkZS5cblx0ICovXG5cdGZ1bmN0aW9uIGNyZWF0ZU1hcmtkb3duU2xpZGUoIGNvbnRlbnQsIG9wdGlvbnMgKSB7XG5cblx0XHRvcHRpb25zID0gZ2V0U2xpZGlmeU9wdGlvbnMoIG9wdGlvbnMgKTtcblxuXHRcdHZhciBub3Rlc01hdGNoID0gY29udGVudC5zcGxpdCggbmV3IFJlZ0V4cCggb3B0aW9ucy5ub3Rlc1NlcGFyYXRvciwgJ21naScgKSApO1xuXG5cdFx0aWYoIG5vdGVzTWF0Y2gubGVuZ3RoID09PSAyICkge1xuXHRcdFx0Y29udGVudCA9IG5vdGVzTWF0Y2hbMF0gKyAnPGFzaWRlIGNsYXNzPVwibm90ZXNcIj4nICsgbWFya2VkKG5vdGVzTWF0Y2hbMV0udHJpbSgpKSArICc8L2FzaWRlPic7XG5cdFx0fVxuXG5cdFx0Ly8gcHJldmVudCBzY3JpcHQgZW5kIHRhZ3MgaW4gdGhlIGNvbnRlbnQgZnJvbSBpbnRlcmZlcmluZ1xuXHRcdC8vIHdpdGggcGFyc2luZ1xuXHRcdGNvbnRlbnQgPSBjb250ZW50LnJlcGxhY2UoIC88XFwvc2NyaXB0Pi9nLCBTQ1JJUFRfRU5EX1BMQUNFSE9MREVSICk7XG5cblx0XHRyZXR1cm4gJzxzY3JpcHQgdHlwZT1cInRleHQvdGVtcGxhdGVcIj4nICsgY29udGVudCArICc8L3NjcmlwdD4nO1xuXG5cdH1cblxuXHQvKipcblx0ICogUGFyc2VzIGEgZGF0YSBzdHJpbmcgaW50byBtdWx0aXBsZSBzbGlkZXMgYmFzZWRcblx0ICogb24gdGhlIHBhc3NlZCBpbiBzZXBhcmF0b3IgYXJndW1lbnRzLlxuXHQgKi9cblx0ZnVuY3Rpb24gc2xpZGlmeSggbWFya2Rvd24sIG9wdGlvbnMgKSB7XG5cblx0XHRvcHRpb25zID0gZ2V0U2xpZGlmeU9wdGlvbnMoIG9wdGlvbnMgKTtcblxuXHRcdHZhciBzZXBhcmF0b3JSZWdleCA9IG5ldyBSZWdFeHAoIG9wdGlvbnMuc2VwYXJhdG9yICsgKCBvcHRpb25zLnZlcnRpY2FsU2VwYXJhdG9yID8gJ3wnICsgb3B0aW9ucy52ZXJ0aWNhbFNlcGFyYXRvciA6ICcnICksICdtZycgKSxcblx0XHRcdGhvcml6b250YWxTZXBhcmF0b3JSZWdleCA9IG5ldyBSZWdFeHAoIG9wdGlvbnMuc2VwYXJhdG9yICk7XG5cblx0XHR2YXIgbWF0Y2hlcyxcblx0XHRcdGxhc3RJbmRleCA9IDAsXG5cdFx0XHRpc0hvcml6b250YWwsXG5cdFx0XHR3YXNIb3Jpem9udGFsID0gdHJ1ZSxcblx0XHRcdGNvbnRlbnQsXG5cdFx0XHRzZWN0aW9uU3RhY2sgPSBbXTtcblxuXHRcdC8vIGl0ZXJhdGUgdW50aWwgYWxsIGJsb2NrcyBiZXR3ZWVuIHNlcGFyYXRvcnMgYXJlIHN0YWNrZWQgdXBcblx0XHR3aGlsZSggbWF0Y2hlcyA9IHNlcGFyYXRvclJlZ2V4LmV4ZWMoIG1hcmtkb3duICkgKSB7XG5cdFx0XHRub3RlcyA9IG51bGw7XG5cblx0XHRcdC8vIGRldGVybWluZSBkaXJlY3Rpb24gKGhvcml6b250YWwgYnkgZGVmYXVsdClcblx0XHRcdGlzSG9yaXpvbnRhbCA9IGhvcml6b250YWxTZXBhcmF0b3JSZWdleC50ZXN0KCBtYXRjaGVzWzBdICk7XG5cblx0XHRcdGlmKCAhaXNIb3Jpem9udGFsICYmIHdhc0hvcml6b250YWwgKSB7XG5cdFx0XHRcdC8vIGNyZWF0ZSB2ZXJ0aWNhbCBzdGFja1xuXHRcdFx0XHRzZWN0aW9uU3RhY2sucHVzaCggW10gKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gcGx1Y2sgc2xpZGUgY29udGVudCBmcm9tIG1hcmtkb3duIGlucHV0XG5cdFx0XHRjb250ZW50ID0gbWFya2Rvd24uc3Vic3RyaW5nKCBsYXN0SW5kZXgsIG1hdGNoZXMuaW5kZXggKTtcblxuXHRcdFx0aWYoIGlzSG9yaXpvbnRhbCAmJiB3YXNIb3Jpem9udGFsICkge1xuXHRcdFx0XHQvLyBhZGQgdG8gaG9yaXpvbnRhbCBzdGFja1xuXHRcdFx0XHRzZWN0aW9uU3RhY2sucHVzaCggY29udGVudCApO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdC8vIGFkZCB0byB2ZXJ0aWNhbCBzdGFja1xuXHRcdFx0XHRzZWN0aW9uU3RhY2tbc2VjdGlvblN0YWNrLmxlbmd0aC0xXS5wdXNoKCBjb250ZW50ICk7XG5cdFx0XHR9XG5cblx0XHRcdGxhc3RJbmRleCA9IHNlcGFyYXRvclJlZ2V4Lmxhc3RJbmRleDtcblx0XHRcdHdhc0hvcml6b250YWwgPSBpc0hvcml6b250YWw7XG5cdFx0fVxuXG5cdFx0Ly8gYWRkIHRoZSByZW1haW5pbmcgc2xpZGVcblx0XHQoIHdhc0hvcml6b250YWwgPyBzZWN0aW9uU3RhY2sgOiBzZWN0aW9uU3RhY2tbc2VjdGlvblN0YWNrLmxlbmd0aC0xXSApLnB1c2goIG1hcmtkb3duLnN1YnN0cmluZyggbGFzdEluZGV4ICkgKTtcblxuXHRcdHZhciBtYXJrZG93blNlY3Rpb25zID0gJyc7XG5cblx0XHQvLyBmbGF0dGVuIHRoZSBoaWVyYXJjaGljYWwgc3RhY2ssIGFuZCBpbnNlcnQgPHNlY3Rpb24gZGF0YS1tYXJrZG93bj4gdGFnc1xuXHRcdGZvciggdmFyIGkgPSAwLCBsZW4gPSBzZWN0aW9uU3RhY2subGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG5cdFx0XHQvLyB2ZXJ0aWNhbFxuXHRcdFx0aWYoIHNlY3Rpb25TdGFja1tpXSBpbnN0YW5jZW9mIEFycmF5ICkge1xuXHRcdFx0XHRtYXJrZG93blNlY3Rpb25zICs9ICc8c2VjdGlvbiAnKyBvcHRpb25zLmF0dHJpYnV0ZXMgKyc+JztcblxuXHRcdFx0XHRzZWN0aW9uU3RhY2tbaV0uZm9yRWFjaCggZnVuY3Rpb24oIGNoaWxkICkge1xuXHRcdFx0XHRcdG1hcmtkb3duU2VjdGlvbnMgKz0gJzxzZWN0aW9uIGRhdGEtbWFya2Rvd24+JyArICBjcmVhdGVNYXJrZG93blNsaWRlKCBjaGlsZCwgb3B0aW9ucyApICsgJzwvc2VjdGlvbj4nO1xuXHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0bWFya2Rvd25TZWN0aW9ucyArPSAnPC9zZWN0aW9uPic7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0bWFya2Rvd25TZWN0aW9ucyArPSAnPHNlY3Rpb24gJysgb3B0aW9ucy5hdHRyaWJ1dGVzICsnIGRhdGEtbWFya2Rvd24+JyArIGNyZWF0ZU1hcmtkb3duU2xpZGUoIHNlY3Rpb25TdGFja1tpXSwgb3B0aW9ucyApICsgJzwvc2VjdGlvbj4nO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBtYXJrZG93blNlY3Rpb25zO1xuXG5cdH1cblxuXHQvKipcblx0ICogUGFyc2VzIGFueSBjdXJyZW50IGRhdGEtbWFya2Rvd24gc2xpZGVzLCBzcGxpdHNcblx0ICogbXVsdGktc2xpZGUgbWFya2Rvd24gaW50byBzZXBhcmF0ZSBzZWN0aW9ucyBhbmRcblx0ICogaGFuZGxlcyBsb2FkaW5nIG9mIGV4dGVybmFsIG1hcmtkb3duLlxuXHQgKi9cblx0ZnVuY3Rpb24gcHJvY2Vzc1NsaWRlcygpIHtcblxuXHRcdHZhciBzZWN0aW9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoICdbZGF0YS1tYXJrZG93bl0nKSxcblx0XHRcdHNlY3Rpb247XG5cblx0XHRmb3IoIHZhciBpID0gMCwgbGVuID0gc2VjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG5cblx0XHRcdHNlY3Rpb24gPSBzZWN0aW9uc1tpXTtcblxuXHRcdFx0aWYoIHNlY3Rpb24uZ2V0QXR0cmlidXRlKCAnZGF0YS1tYXJrZG93bicgKS5sZW5ndGggKSB7XG5cblx0XHRcdFx0dmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLFxuXHRcdFx0XHRcdHVybCA9IHNlY3Rpb24uZ2V0QXR0cmlidXRlKCAnZGF0YS1tYXJrZG93bicgKTtcblxuXHRcdFx0XHRkYXRhY2hhcnNldCA9IHNlY3Rpb24uZ2V0QXR0cmlidXRlKCAnZGF0YS1jaGFyc2V0JyApO1xuXG5cdFx0XHRcdC8vIHNlZSBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9BUEkvZWxlbWVudC5nZXRBdHRyaWJ1dGUjTm90ZXNcblx0XHRcdFx0aWYoIGRhdGFjaGFyc2V0ICE9IG51bGwgJiYgZGF0YWNoYXJzZXQgIT0gJycgKSB7XG5cdFx0XHRcdFx0eGhyLm92ZXJyaWRlTWltZVR5cGUoICd0ZXh0L2h0bWw7IGNoYXJzZXQ9JyArIGRhdGFjaGFyc2V0ICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0aWYoIHhoci5yZWFkeVN0YXRlID09PSA0ICkge1xuXHRcdFx0XHRcdFx0Ly8gZmlsZSBwcm90b2NvbCB5aWVsZHMgc3RhdHVzIGNvZGUgMCAodXNlZnVsIGZvciBsb2NhbCBkZWJ1ZywgbW9iaWxlIGFwcGxpY2F0aW9ucyBldGMuKVxuXHRcdFx0XHRcdFx0aWYgKCAoIHhoci5zdGF0dXMgPj0gMjAwICYmIHhoci5zdGF0dXMgPCAzMDAgKSB8fCB4aHIuc3RhdHVzID09PSAwICkge1xuXG5cdFx0XHRcdFx0XHRcdHNlY3Rpb24ub3V0ZXJIVE1MID0gc2xpZGlmeSggeGhyLnJlc3BvbnNlVGV4dCwge1xuXHRcdFx0XHRcdFx0XHRcdHNlcGFyYXRvcjogc2VjdGlvbi5nZXRBdHRyaWJ1dGUoICdkYXRhLXNlcGFyYXRvcicgKSxcblx0XHRcdFx0XHRcdFx0XHR2ZXJ0aWNhbFNlcGFyYXRvcjogc2VjdGlvbi5nZXRBdHRyaWJ1dGUoICdkYXRhLXNlcGFyYXRvci12ZXJ0aWNhbCcgKSxcblx0XHRcdFx0XHRcdFx0XHRub3Rlc1NlcGFyYXRvcjogc2VjdGlvbi5nZXRBdHRyaWJ1dGUoICdkYXRhLXNlcGFyYXRvci1ub3RlcycgKSxcblx0XHRcdFx0XHRcdFx0XHRhdHRyaWJ1dGVzOiBnZXRGb3J3YXJkZWRBdHRyaWJ1dGVzKCBzZWN0aW9uIClcblx0XHRcdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGVsc2Uge1xuXG5cdFx0XHRcdFx0XHRcdHNlY3Rpb24ub3V0ZXJIVE1MID0gJzxzZWN0aW9uIGRhdGEtc3RhdGU9XCJhbGVydFwiPicgK1xuXHRcdFx0XHRcdFx0XHRcdCdFUlJPUjogVGhlIGF0dGVtcHQgdG8gZmV0Y2ggJyArIHVybCArICcgZmFpbGVkIHdpdGggSFRUUCBzdGF0dXMgJyArIHhoci5zdGF0dXMgKyAnLicgK1xuXHRcdFx0XHRcdFx0XHRcdCdDaGVjayB5b3VyIGJyb3dzZXJcXCdzIEphdmFTY3JpcHQgY29uc29sZSBmb3IgbW9yZSBkZXRhaWxzLicgK1xuXHRcdFx0XHRcdFx0XHRcdCc8cD5SZW1lbWJlciB0aGF0IHlvdSBuZWVkIHRvIHNlcnZlIHRoZSBwcmVzZW50YXRpb24gSFRNTCBmcm9tIGEgSFRUUCBzZXJ2ZXIuPC9wPicgK1xuXHRcdFx0XHRcdFx0XHRcdCc8L3NlY3Rpb24+JztcblxuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblxuXHRcdFx0XHR4aHIub3BlbiggJ0dFVCcsIHVybCwgZmFsc2UgKTtcblxuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdHhoci5zZW5kKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Y2F0Y2ggKCBlICkge1xuXHRcdFx0XHRcdGFsZXJ0KCAnRmFpbGVkIHRvIGdldCB0aGUgTWFya2Rvd24gZmlsZSAnICsgdXJsICsgJy4gTWFrZSBzdXJlIHRoYXQgdGhlIHByZXNlbnRhdGlvbiBhbmQgdGhlIGZpbGUgYXJlIHNlcnZlZCBieSBhIEhUVFAgc2VydmVyIGFuZCB0aGUgZmlsZSBjYW4gYmUgZm91bmQgdGhlcmUuICcgKyBlICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fVxuXHRcdFx0ZWxzZSBpZiggc2VjdGlvbi5nZXRBdHRyaWJ1dGUoICdkYXRhLXNlcGFyYXRvcicgKSB8fCBzZWN0aW9uLmdldEF0dHJpYnV0ZSggJ2RhdGEtc2VwYXJhdG9yLXZlcnRpY2FsJyApIHx8IHNlY3Rpb24uZ2V0QXR0cmlidXRlKCAnZGF0YS1zZXBhcmF0b3Itbm90ZXMnICkgKSB7XG5cblx0XHRcdFx0c2VjdGlvbi5vdXRlckhUTUwgPSBzbGlkaWZ5KCBnZXRNYXJrZG93bkZyb21TbGlkZSggc2VjdGlvbiApLCB7XG5cdFx0XHRcdFx0c2VwYXJhdG9yOiBzZWN0aW9uLmdldEF0dHJpYnV0ZSggJ2RhdGEtc2VwYXJhdG9yJyApLFxuXHRcdFx0XHRcdHZlcnRpY2FsU2VwYXJhdG9yOiBzZWN0aW9uLmdldEF0dHJpYnV0ZSggJ2RhdGEtc2VwYXJhdG9yLXZlcnRpY2FsJyApLFxuXHRcdFx0XHRcdG5vdGVzU2VwYXJhdG9yOiBzZWN0aW9uLmdldEF0dHJpYnV0ZSggJ2RhdGEtc2VwYXJhdG9yLW5vdGVzJyApLFxuXHRcdFx0XHRcdGF0dHJpYnV0ZXM6IGdldEZvcndhcmRlZEF0dHJpYnV0ZXMoIHNlY3Rpb24gKVxuXHRcdFx0XHR9KTtcblxuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHNlY3Rpb24uaW5uZXJIVE1MID0gY3JlYXRlTWFya2Rvd25TbGlkZSggZ2V0TWFya2Rvd25Gcm9tU2xpZGUoIHNlY3Rpb24gKSApO1xuXHRcdFx0fVxuXHRcdH1cblxuXHR9XG5cblx0LyoqXG5cdCAqIENoZWNrIGlmIGEgbm9kZSB2YWx1ZSBoYXMgdGhlIGF0dHJpYnV0ZXMgcGF0dGVybi5cblx0ICogSWYgeWVzLCBleHRyYWN0IGl0IGFuZCBhZGQgdGhhdCB2YWx1ZSBhcyBvbmUgb3Igc2V2ZXJhbCBhdHRyaWJ1dGVzXG5cdCAqIHRoZSB0aGUgdGVyZ2V0IGVsZW1lbnQuXG5cdCAqXG5cdCAqIFlvdSBuZWVkIENhY2hlIEtpbGxlciBvbiBDaHJvbWUgdG8gc2VlIHRoZSBlZmZlY3Qgb24gYW55IEZPTSB0cmFuc2Zvcm1hdGlvblxuXHQgKiBkaXJlY3RseSBvbiByZWZyZXNoIChGNSlcblx0ICogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy81NjkwMjY5L2Rpc2FibGluZy1jaHJvbWUtY2FjaGUtZm9yLXdlYnNpdGUtZGV2ZWxvcG1lbnQvNzAwMDg5OSNhbnN3ZXItMTE3ODYyNzdcblx0ICovXG5cdGZ1bmN0aW9uIGFkZEF0dHJpYnV0ZUluRWxlbWVudCggbm9kZSwgZWxlbWVudFRhcmdldCwgc2VwYXJhdG9yICkge1xuXG5cdFx0dmFyIG1hcmRvd25DbGFzc2VzSW5FbGVtZW50c1JlZ2V4ID0gbmV3IFJlZ0V4cCggc2VwYXJhdG9yLCAnbWcnICk7XG5cdFx0dmFyIG1hcmRvd25DbGFzc1JlZ2V4ID0gbmV3IFJlZ0V4cCggXCIoW15cXFwiPSBdKz8pPVxcXCIoW15cXFwiPV0rPylcXFwiXCIsICdtZycgKTtcblx0XHR2YXIgbm9kZVZhbHVlID0gbm9kZS5ub2RlVmFsdWU7XG5cdFx0aWYoIG1hdGNoZXMgPSBtYXJkb3duQ2xhc3Nlc0luRWxlbWVudHNSZWdleC5leGVjKCBub2RlVmFsdWUgKSApIHtcblxuXHRcdFx0dmFyIGNsYXNzZXMgPSBtYXRjaGVzWzFdO1xuXHRcdFx0bm9kZVZhbHVlID0gbm9kZVZhbHVlLnN1YnN0cmluZyggMCwgbWF0Y2hlcy5pbmRleCApICsgbm9kZVZhbHVlLnN1YnN0cmluZyggbWFyZG93bkNsYXNzZXNJbkVsZW1lbnRzUmVnZXgubGFzdEluZGV4ICk7XG5cdFx0XHRub2RlLm5vZGVWYWx1ZSA9IG5vZGVWYWx1ZTtcblx0XHRcdHdoaWxlKCBtYXRjaGVzQ2xhc3MgPSBtYXJkb3duQ2xhc3NSZWdleC5leGVjKCBjbGFzc2VzICkgKSB7XG5cdFx0XHRcdGVsZW1lbnRUYXJnZXQuc2V0QXR0cmlidXRlKCBtYXRjaGVzQ2xhc3NbMV0sIG1hdGNoZXNDbGFzc1syXSApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdC8qKlxuXHQgKiBBZGQgYXR0cmlidXRlcyB0byB0aGUgcGFyZW50IGVsZW1lbnQgb2YgYSB0ZXh0IG5vZGUsXG5cdCAqIG9yIHRoZSBlbGVtZW50IG9mIGFuIGF0dHJpYnV0ZSBub2RlLlxuXHQgKi9cblx0ZnVuY3Rpb24gYWRkQXR0cmlidXRlcyggc2VjdGlvbiwgZWxlbWVudCwgcHJldmlvdXNFbGVtZW50LCBzZXBhcmF0b3JFbGVtZW50QXR0cmlidXRlcywgc2VwYXJhdG9yU2VjdGlvbkF0dHJpYnV0ZXMgKSB7XG5cblx0XHRpZiAoIGVsZW1lbnQgIT0gbnVsbCAmJiBlbGVtZW50LmNoaWxkTm9kZXMgIT0gdW5kZWZpbmVkICYmIGVsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggPiAwICkge1xuXHRcdFx0cHJldmlvdXNQYXJlbnRFbGVtZW50ID0gZWxlbWVudDtcblx0XHRcdGZvciggdmFyIGkgPSAwOyBpIDwgZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrICkge1xuXHRcdFx0XHRjaGlsZEVsZW1lbnQgPSBlbGVtZW50LmNoaWxkTm9kZXNbaV07XG5cdFx0XHRcdGlmICggaSA+IDAgKSB7XG5cdFx0XHRcdFx0aiA9IGkgLSAxO1xuXHRcdFx0XHRcdHdoaWxlICggaiA+PSAwICkge1xuXHRcdFx0XHRcdFx0YVByZXZpb3VzQ2hpbGRFbGVtZW50ID0gZWxlbWVudC5jaGlsZE5vZGVzW2pdO1xuXHRcdFx0XHRcdFx0aWYgKCB0eXBlb2YgYVByZXZpb3VzQ2hpbGRFbGVtZW50LnNldEF0dHJpYnV0ZSA9PSAnZnVuY3Rpb24nICYmIGFQcmV2aW91c0NoaWxkRWxlbWVudC50YWdOYW1lICE9IFwiQlJcIiApIHtcblx0XHRcdFx0XHRcdFx0cHJldmlvdXNQYXJlbnRFbGVtZW50ID0gYVByZXZpb3VzQ2hpbGRFbGVtZW50O1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGogPSBqIC0gMTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0cGFyZW50U2VjdGlvbiA9IHNlY3Rpb247XG5cdFx0XHRcdGlmKCBjaGlsZEVsZW1lbnQubm9kZU5hbWUgPT0gIFwic2VjdGlvblwiICkge1xuXHRcdFx0XHRcdHBhcmVudFNlY3Rpb24gPSBjaGlsZEVsZW1lbnQgO1xuXHRcdFx0XHRcdHByZXZpb3VzUGFyZW50RWxlbWVudCA9IGNoaWxkRWxlbWVudCA7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCB0eXBlb2YgY2hpbGRFbGVtZW50LnNldEF0dHJpYnV0ZSA9PSAnZnVuY3Rpb24nIHx8IGNoaWxkRWxlbWVudC5ub2RlVHlwZSA9PSBOb2RlLkNPTU1FTlRfTk9ERSApIHtcblx0XHRcdFx0XHRhZGRBdHRyaWJ1dGVzKCBwYXJlbnRTZWN0aW9uLCBjaGlsZEVsZW1lbnQsIHByZXZpb3VzUGFyZW50RWxlbWVudCwgc2VwYXJhdG9yRWxlbWVudEF0dHJpYnV0ZXMsIHNlcGFyYXRvclNlY3Rpb25BdHRyaWJ1dGVzICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAoIGVsZW1lbnQubm9kZVR5cGUgPT0gTm9kZS5DT01NRU5UX05PREUgKSB7XG5cdFx0XHRpZiAoIGFkZEF0dHJpYnV0ZUluRWxlbWVudCggZWxlbWVudCwgcHJldmlvdXNFbGVtZW50LCBzZXBhcmF0b3JFbGVtZW50QXR0cmlidXRlcyApID09IGZhbHNlICkge1xuXHRcdFx0XHRhZGRBdHRyaWJ1dGVJbkVsZW1lbnQoIGVsZW1lbnQsIHNlY3Rpb24sIHNlcGFyYXRvclNlY3Rpb25BdHRyaWJ1dGVzICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0LyoqXG5cdCAqIENvbnZlcnRzIGFueSBjdXJyZW50IGRhdGEtbWFya2Rvd24gc2xpZGVzIGluIHRoZVxuXHQgKiBET00gdG8gSFRNTC5cblx0ICovXG5cdGZ1bmN0aW9uIGNvbnZlcnRTbGlkZXMoKSB7XG5cblx0XHR2YXIgc2VjdGlvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCAnW2RhdGEtbWFya2Rvd25dJyk7XG5cblx0XHRmb3IoIHZhciBpID0gMCwgbGVuID0gc2VjdGlvbnMubGVuZ3RoOyBpIDwgbGVuOyBpKysgKSB7XG5cblx0XHRcdHZhciBzZWN0aW9uID0gc2VjdGlvbnNbaV07XG5cblx0XHRcdC8vIE9ubHkgcGFyc2UgdGhlIHNhbWUgc2xpZGUgb25jZVxuXHRcdFx0aWYoICFzZWN0aW9uLmdldEF0dHJpYnV0ZSggJ2RhdGEtbWFya2Rvd24tcGFyc2VkJyApICkge1xuXG5cdFx0XHRcdHNlY3Rpb24uc2V0QXR0cmlidXRlKCAnZGF0YS1tYXJrZG93bi1wYXJzZWQnLCB0cnVlIClcblxuXHRcdFx0XHR2YXIgbm90ZXMgPSBzZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoICdhc2lkZS5ub3RlcycgKTtcblx0XHRcdFx0dmFyIG1hcmtkb3duID0gZ2V0TWFya2Rvd25Gcm9tU2xpZGUoIHNlY3Rpb24gKTtcblxuXHRcdFx0XHRzZWN0aW9uLmlubmVySFRNTCA9IG1hcmtlZCggbWFya2Rvd24gKTtcblx0XHRcdFx0YWRkQXR0cmlidXRlcyggXHRzZWN0aW9uLCBzZWN0aW9uLCBudWxsLCBzZWN0aW9uLmdldEF0dHJpYnV0ZSggJ2RhdGEtZWxlbWVudC1hdHRyaWJ1dGVzJyApIHx8XG5cdFx0XHRcdFx0XHRcdFx0c2VjdGlvbi5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSggJ2RhdGEtZWxlbWVudC1hdHRyaWJ1dGVzJyApIHx8XG5cdFx0XHRcdFx0XHRcdFx0REVGQVVMVF9FTEVNRU5UX0FUVFJJQlVURVNfU0VQQVJBVE9SLFxuXHRcdFx0XHRcdFx0XHRcdHNlY3Rpb24uZ2V0QXR0cmlidXRlKCAnZGF0YS1hdHRyaWJ1dGVzJyApIHx8XG5cdFx0XHRcdFx0XHRcdFx0c2VjdGlvbi5wYXJlbnROb2RlLmdldEF0dHJpYnV0ZSggJ2RhdGEtYXR0cmlidXRlcycgKSB8fFxuXHRcdFx0XHRcdFx0XHRcdERFRkFVTFRfU0xJREVfQVRUUklCVVRFU19TRVBBUkFUT1IpO1xuXG5cdFx0XHRcdC8vIElmIHRoZXJlIHdlcmUgbm90ZXMsIHdlIG5lZWQgdG8gcmUtYWRkIHRoZW0gYWZ0ZXJcblx0XHRcdFx0Ly8gaGF2aW5nIG92ZXJ3cml0dGVuIHRoZSBzZWN0aW9uJ3MgSFRNTFxuXHRcdFx0XHRpZiggbm90ZXMgKSB7XG5cdFx0XHRcdFx0c2VjdGlvbi5hcHBlbmRDaGlsZCggbm90ZXMgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9XG5cblx0XHR9XG5cblx0fVxuXG5cdC8vIEFQSVxuXHRyZXR1cm4ge1xuXG5cdFx0aW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRwcm9jZXNzU2xpZGVzKCk7XG5cdFx0XHRjb252ZXJ0U2xpZGVzKCk7XG5cdFx0fSxcblxuXHRcdC8vIFRPRE86IERvIHRoZXNlIGJlbG9uZyBpbiB0aGUgQVBJP1xuXHRcdHByb2Nlc3NTbGlkZXM6IHByb2Nlc3NTbGlkZXMsXG5cdFx0Y29udmVydFNsaWRlczogY29udmVydFNsaWRlcyxcblx0XHRzbGlkaWZ5OiBzbGlkaWZ5XG5cblx0fTtcblxufSkpO1xuIl19
